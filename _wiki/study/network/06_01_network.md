---
layout  : wiki
title   : 로드밸런서 (4계층 장비)
summary : 
date    : 2021-11-06 09:00:00 +0900
updated : 2021-11-06 09:00:01 +0900
tag     : network
toc     : true
public  : true
parent  : [[/index]]
latex   : true
---
* TOC
{:toc}

![load_balancer](https://user-images.githubusercontent.com/24386223/140600346-5153db55-4fd2-49ef-9437-d26daacfa14e.png)

_↑↑↑ 로드밸런서_

![tcp_packet](https://user-images.githubusercontent.com/24386223/140610111-62a1000e-3b9f-4d50-9be4-16720d324b5b.png)

_↑↑↑ TCP Packet_

![http_packet](https://user-images.githubusercontent.com/24386223/140610130-b48f5048-d81e-4969-915a-13a1f2d1e72d.png)

_↑↑↑ HTTP Packet_

## 개 요

* 서버나 네트워크 장비의 부하를 분산하기 위해 사용하는 4계층 네트워크 장비

## 로드 밸런싱을 사용하는 이유

* 시스템 확장이 필요한 정보로 서비스 요청이 증가하는 경우 스케일 업 또는 스케일 아웃이 요구됨

* 스케일 업

    * 기존 시스템에 CPU, 메모리, 디스크와 같은 내부 컴포넌트의 성능과 용량을 증설하는 확장 방식

    * 물리적인 제약과 비용적인 제약이 큼

* 스케일 아웃

    * 여러 서버 시스템을 묶어 하나의 서버 시스템처럼 운영하는 확장 방식

    * 여러 대의 서버에 요청을 분산 처리해야 하므로 복잡한 아키텍처를 이해하고 운영해야 함

    * 스케일 업에 비해 물리적, 비용적 제약이 적은 편임

## 로드 밸런서의 종류

* L4 로드 밸런싱 (Network Load Balancing)

    * 네트워크 계층(IP)의 정보와 포트 번호를 기반으로 로드 밸런싱 수행

    * 가상 서버와 실제 서버, 가상 IP(VIP)와 실제 IP(RIP)를 매핑함

    * 패킷을 수신하면 가상 서버와 가상 IP로 들어온 목적지를 실제 서버와 실제 IP로 변경함

<br/>

* L7 로드 밸런싱 (Application Load Balancing)

    * 애플리케이션 계층(HTTP, FTP, SMTP와 같은 애플리케이션 프로토콜)의 정보를 기반으로 로드 밸런싱 수행

    * 페일오버(장애 극복), 리다이렉션 외에도 압축, 콘텐츠 변환 및 재작성, 인코딩 변환 등의 기능도 제공

<br/>

## 로드 밸런서의 알고리즘

* 라운드 로빈(Round Robin)

    * 특별한 규칙 없이 서버가 순번에 따라 요청을 처리하도록 분산하는 방식

* 최소 접속 방식(Least Connection)

    * 세션 테이블을 확인하여 현재 기준으로 세션이 가장 적게 연결된 서버로 서비스 요청을 전달하는 방식

* 가중치 기반 라운드 로빈(Weighted Round Robin)

    * 정수값 가중치 순으로 서버에 순번을 매기고 순번과 비율에 따라 요청을 처리하도록 분산하는 방식

    * 라운드 로빈은 가중치 기반 라운드 로빈 스케쥴링의 가중치가 동일한 경우임

    * 서버가 A,B,C 이고 각각의 가중치가 4,3,2 일 경우 스케쥴링 순서는 ABCABCABA-ABCABCABA가 됨

* 해시(Hash)
    
    * 서버의 부하를 고려하지 않고 클라이언트가 같은 서버에 지속적으로 접속하도록 하기 위해 사용하는 부하 분산 방식

    * 해시 알고리즘에 의한 계산 값은 항상 동일하며, 출발지 IP 주소, 목적지 IP 주소, 출발지 서비스 포트, 목적지 서비스 포트 정보를 사용함

    * 세션을 유지해야 하는 서비스에 적합한 분산 방식

    * 애플리케이션 개발시 여러 대의 서버가 사용될 것을 고려하지 않은 경우 해시 방식의 로드 밸런싱을 사용해야 함

## Links

* [neocjmix.github.io](https://neocjmix.github.io/etc/2015/08/26/add-server): 서버 추가를 통한 성능개선
